---
name: orch-start-automation-prd
version: 0.1
date: 2025-08-12
status: Draft
owner: Product Manager
source: PRDs/README.md (Agent Prompt: ORCH START)
milestone: M0 (2.1.1.12)
---

<a id="sec-1"></a>
## 1. Executive Summary

Define and deliver the ORCH START automation so that, when invoked in a fresh chat with an optional target `ROADMAP_ID`, it consistently activates the right team roles, decomposes the target PRD into an executable plan, scaffolds required QA artifacts, executes the default workflow (lints → build → tests → E2E), enforces QA/Security gates, and updates roadmap + HTML mirror with evidence links, all with minimal, reversible edits.

<a id="sec-2"></a>
## 2. Scope
- In scope:
  - Chat trigger parsing: `ORCH START` with support for:
    - Single: `ORCH START` (auto-select) or `ORCH START 2.1.1.4`
    - Range: `ORCH START 2.1.1.3 → 2.1.1.7` or `ORCH START RANGE START=2.1.1.3 END=2.1.1.7` (alias of Range Execution in `PRDs/README.md`)
    - List: `ORCH START LIST=2.1.1.2,2.1.1.4,2.1.1.6` or `ORCH START ITEMS 2.1.1.2, 2.1.1.4, 2.1.1.6` (alias of List Execution in `PRDs/README.md`)
  - Team activation: record owners in PRD frontmatter and sections 9.1/9.3 based on `team/*.md` roles.
  - PRD task decomposition: insert an “Execution Plan (Decomposed Tasks)” table after §9.3 with role‑scoped tasks and dependencies.
  - QA scaffolding: ensure `QA/<id>-<slug>/test-cases.md` exists; create `test-results-<DATE>.md` upon first run.
  - Default workflow execution: non‑interactive install, lints, typecheck, unit/integration tests; start dev server if needed; Playwright E2E; artifact capture.
  - Gates and flips: enforce QA Pass and security evidence before flipping roadmap to Ready/Done; mirror to `docs/product-roadmap.html`.
  - Idempotency: re‑invocation updates/extends existing artifacts without duplication.
- Out of scope:
  - Implementing feature‑specific code beyond orchestrator responsibilities.
  - Multi‑repo orchestration.
  - Human notification tooling beyond concise summaries already defined in `PRDs/README.md`.

<a id="sec-3"></a>
## 3. Success Criteria
- Invoking `ORCH START` (with or without `ROADMAP_ID`) results in:
  1) Team owners recorded in PRD frontmatter and §9.1/§9.3.
  2) An “Execution Plan (Decomposed Tasks)” table added under §9.3, populated with ordered tasks, dependencies, and outputs.
  3) QA artifacts exist with paths reflected in §7.3 and §9.4.
  4) Default workflow executed; artifacts generated; failures surfaced with minimal‑edit proposals.
  5) Status flips and HTML mirror updates occur only after QA Pass is published and linked in §9.4.
  6) All links in `docs/product-roadmap.html` resolve locally (file://) to existing targets.

<a id="sec-4"></a>
## 4. User Stories
- As a PM/TPM, I can trigger `ORCH START` and see the PRD populated with owners and a decomposed, dependency‑aware execution plan.
- As an engineer, I get minimal, reversible edit proposals with clear file paths and guardrails after test runs.
- As QA, I have a ready QA folder with test cases scaffolded and a results file created/updated on runs.
- As an exec, I see synchronized roadmap + HTML mirror with clickable evidence links only after gates pass.

<a id="sec-5"></a>
## 5. Functional Requirements
1. Trigger recognition: Accept `ORCH START` (case‑insensitive) with the following grammar:
   - Single Feature Mode:
     - `ORCH START` (no ID): auto-selects earliest In Progress; if none, earliest Planned.
     - `ORCH START <ROADMAP_ID>`: e.g., `ORCH START 2.1.1.4`.
   - Range Mode (aliases of Range Execution):
     - `ORCH START <START_ID> → <END_ID>`: e.g., `ORCH START 2.1.1.3 → 2.1.1.7`.
     - `ORCH START RANGE START=<START_ID> END=<END_ID>`.
   - List Mode (aliases of List Execution):
     - `ORCH START LIST=<ID1>,<ID2>,<ID3>`.
     - `ORCH START ITEMS <ID1>, <ID2>, <ID3>`.
2. Discovery: If `ROADMAP_ID` is absent, prompt selection rules: choose the earliest In Progress item; if none, the earliest Planned item.
3. Team activation: Map roles from `team/*.md`; write owners to PRD frontmatter `owner:` and record roles in §9.1 and inputs/outputs in §9.3.
4. PRD task decomposition: Insert a markdown table under §9.3 with Task ID, Owner (Role), Description, Dependencies, Outputs (files/PRD sections), Risks/Issues, Status.
5. QA scaffolding: Ensure `QA/<id>-<slug>/test-cases.md` exists; on first run of tests create `test-results-<DATE>.md`; update PRD §7.3 and §9.4 paths.
6. Default workflow execution (non‑interactive): install deps; run lints/typecheck/unit/integration; start dev server (background) if needed; run Playwright E2E; capture screenshots/traces.
7. Gate enforcement: Block Ready/Done flips unless §9.4 shows QA results path with Overall Status: Pass and security evidence present.
8. Roadmap sync: Update `Plans/product-roadmap.md` status and mirror `docs/product-roadmap.html` with clickable links in the Output column, preserving ordering rules.
9. Idempotency: Re‑runs update existing tables/owners and append to changelog without duplicating sections.
10. Evidence: Summaries include file paths and a Proof‑of‑Done checklist per `PRDs/README.md`.

<a id="sec-6"></a>
## 6. Technical Requirements

<a id="sec-6-1"></a>
### 6.1 Architecture
- Orchestrator state machine embedded in the agent workflow described in `PRDs/README.md`.
- Deterministic steps: Discover → Activate team → Decompose → Execute → Test/Verify → Gate/Flip → Mirror.
- Tooling: Filesystem edits, semantic + grep search, terminal (non‑interactive), Playwright browser. Model routing via LiteLLM when applicable.

<a id="sec-6-2"></a>
### 6.2 Data Model
- Inputs: `ROADMAP_ID`, PRD path, QA folder path, team roles.
- Outputs: PRD updates (§§7.3, 8, 9.x, 10), QA artifacts, roadmap + HTML mirror updates, test artifacts.

<a id="sec-6-3"></a>
### 6.3 Storage/Schema
- File‑based mutations only; no DB dependencies.
- Ensure PRD and QA paths conform to repository conventions; all mirror links resolve.

<a id="sec-6-4"></a>
### 6.4 Validation
- Validate `ROADMAP_ID` exists in `Plans/product-roadmap.md`.
- Validate PRD sections 1–6 exist before engaging reviewers; ensure §7.3 paths and §9.x blocks present.
- Detect and prevent duplicate insertion of Execution Plan table.

<a id="sec-6-5"></a>
### 6.5 UI/UX
- Status and summary notes follow concise, high‑signal format; include file paths and gate states.

<a id="sec-6-6"></a>
### 6.6 Legal/Privacy
- No credentials or secrets recorded; no PII persisted by automation.

<a id="sec-7"></a>
## 7. Testing & Acceptance

<a id="sec-7-1"></a>
### 7.1 Test Scenarios
1. `ORCH START 2.1.1.4` inserts Execution Plan in the target PRD under §9.3; owners recorded; QA paths present in §7.3/§9.4.
2. `ORCH START` (no ID) selects earliest In Progress or Planned item; behaves as above.
3. Re‑run idempotency: second invocation updates/extends without duplications.
4. Gate enforcement: no Ready flip when QA results show Fail or are missing.
5. Roadmap mirror sync: HTML links resolve; ordering rule maintained.
6. Range Mode: `ORCH START 2.1.1.2 → 2.1.1.4` processes items in document order, applying per‑feature workflow for each; stops only on unresolved PRD 9.7 blockers.
7. List Mode: `ORCH START LIST=2.1.1.2,2.1.1.4,2.1.1.6` processes listed items in the given order; skips missing IDs with a final summary note.

<a id="sec-7-2"></a>
### 7.2 Acceptance Criteria
- All scenarios pass; Overall Status: Pass in QA results.
- Proof‑of‑Done checklist satisfied; security evidence recorded where applicable.

<a id="sec-7-3"></a>
### 7.3 QA Artifacts
- Test cases file: `QA/2.1.1.12-orch-start-automation/test-cases.md`
- Latest results: `QA/2.1.1.12-orch-start-automation/test-results-<yyyy-mm-dd>.md` (Overall Status: Pass required)

<a id="sec-8"></a>
## 8. Changelog
- v0.1: Initial draft created for stakeholder review.

<a id="sec-9"></a>
## 9. Collaboration & Review Workflow

<a id="sec-9-1"></a>
### 9.1 Roles and Order
- PM → VP-Product → Technical Product Manager → CTO → Security → UX/UI → Legal → QA → VP‑Eng → Implementation Owner

<a id="sec-9-2"></a>
### 9.2 Where Communication Happens
- Primary: this PRD (`PRDs/M0/2.1.1.12-orch-start-automation-prd.md`)
- Status: `Plans/product-roadmap.md` (TBD ID until roadmap addition)

<a id="sec-9-3"></a>
### 9.3 Handoff Contracts (Inputs → Outputs)
- PM: define scope/success criteria; approve task decomposition format.
- VP-Product: confirm KPIs and gating alignment.
- Technical Product Manager: specify trigger grammar, idempotency rules, and evidence schema; link §10.
- CTO: tool usage defaults; non‑interactive execution; background jobs; ordering rules.
- Security: scans evidence expectations; no High/Critical gate.
- UX: summary formatting; link hygiene.
- Legal: none (N/A) unless copy policies updated.
- QA: test scenarios and acceptance; publish results.
- VP‑Eng: feasibility/sequencing; Ready recommendation.
- Implementation Owner: minimal, reversible edit strategy; rollback notes.

#### Execution Plan (Decomposed Tasks)

| Task ID | Owner (Role) | Description | Preconditions/Dependencies | Outputs (Files/PRD sections) | Risks/Issues | Status |
| --- | --- | --- | --- | --- | --- | --- |
| ORCH-01 | Technical Product Manager | Define trigger grammar (Single/Range/List) and auto-select heuristic | PRDs/README baseline | PRD §5 finalized; examples in §7 | Ambiguity in mixed states | Planned |
| ORCH-02 | Product Manager | Finalize owners matrix and update PRD frontmatter/§9.1/§9.3 schema | ORCH-01 | PRD header owner; §9.1/§9.3 filled | Owner drift | Planned |
| ORCH-03 | Implementation Owner | PRD editor design: idempotent table injection after §9.3 with dedupe rules | ORCH-01 | Edit spec; re-run behavior documented | Duplicate insertions | Planned |
| ORCH-04 | Backend Engineer | Implement orchestrator entry `lib/orch-start.mjs` with parser (Single/Range/List) and `--dry-run` | ORCH-01 | `lib/orch-start.mjs` | Parser edge cases | Planned |
| ORCH-05 | Backend Engineer | Implement PRD utilities: owner/frontmatter update, §9.1/§9.3 fill, §7.3/§9.4 paths | ORCH-03, ORCH-04 | `lib/orch/prd-utils.mjs` | Markdown parsing fragility | Planned |
| ORCH-06 | Backend Engineer | Implement QA utilities: ensure `QA/<id>-<slug>/test-cases.md` and create results stub | ORCH-04 | `lib/orch/qa-utils.mjs` | Path calc errors | Planned |
| ORCH-07 | Backend Engineer | Implement roadmap utilities: flip status, backtick paths, regen HTML mirror | ORCH-04 | `lib/orch/roadmap-utils.mjs` | Ordering rule regressions | Planned |
| ORCH-08 | Backend Engineer | Implement workflow runner: install → lint → test → dev server (bg) → Playwright | ORCH-04 | `lib/orch/workflow-runner.mjs` | Long runtime; CI differences | Planned |
| ORCH-09 | DevOps/SRE | Add npm scripts and docs: `orch:start`, `orch:dry-run`; update Commands template | ORCH-04..ORCH-08 | `package.json`, `PRDs/_templates/Commands` | Script portability | Planned |
| ORCH-10 | QA Engineer | Unit tests for parser and utils (Vitest) | ORCH-04..ORCH-07 | `tests/orch/parser.test.mjs`, `tests/orch/prd-utils.test.mjs` | Flaky file ops on CI | Planned |
| ORCH-11 | QA Engineer | CLI smoke: dry-run on Single/Range/List; assert no file mutations | ORCH-09, ORCH-10 | `tests/orch/cli-dry-run.test.mjs` | Env variance | Planned |
| ORCH-12 | QA Engineer | End-to-end run on a safe feature ID; publish results | ORCH-08, ORCH-10 | `QA/2.1.1.12-orch-start-automation/test-results-<DATE>.md` | Flaky E2E | Planned |
| ORCH-13 | Security | Define scans to run and evidence capture (deps/SAST/secrets/SBOM) | ORCH-08 | Links in §7.3/§9.4 | Tool availability | Planned |
| ORCH-14 | CTO | Finalize non-interactive defaults and backgrounding policy in docs | ORCH-08 | PRD §6 updated | Long-running tasks | Planned |
| ORCH-15 | VP‑Eng | Validate gate enforcement and sequencing; sign Ready rec | ORCH-12, ORCH-13 | §9.4 checks; §9.6 decision | Incomplete evidence | Planned |
| ORCH-16 | Implementation Owner | Idempotency guard implementation and regression tests | ORCH-05 | Table dedupe logic; tests | Hidden duplicates | Planned |
| ORCH-17 | Product Manager | Update PRD §8 (Changelog) and cross-link QA/roadmap paths | ORCH-12 | PRD §8 entries | Missed links | Planned |
| ORCH-18 | DevOps/SRE | Mirror validation: click-check representative links in HTML | ORCH-07 | Verified `docs/product-roadmap.html` | Broken local links | Planned |
| ORCH-19 | Technical Product Manager | Range/List execution rules alignment with `PRDs/README.md` | ORCH-01 | PRD §5, §7 updated | Divergence with README | Planned |
| ORCH-20 | QA Engineer | Final acceptance run across Single/Range/List; summarize | ORCH-15, ORCH-18 | QA summary appended to `test-results-<DATE>.md` | Residual flakiness | Planned |

<a id="sec-9-4"></a>
### 9.4 Review Log & Sign‑offs
- [ ] PM — Confirmed
- [ ] VP-Product — Confirmed
- [ ] Technical Product Manager — Confirmed; §10 links
- [ ] CTO — Confirmed
- [ ] Security — Scans attached; no High/Critical
- [ ] UX — Confirmed
- [ ] Legal — Confirmed (or N/A)
- [ ] QA — Results published at: `QA/2.1.1.12-orch-start-automation/test-results-<yyyy-mm-dd>.md`
- [ ] VP‑Eng — Ready
- [ ] Implementation Owner — Risks/rollback

<a id="sec-9-5"></a>
### 9.5 Reviewer Notes

<a id="sec-9-6"></a>
### 9.6 Decision Log

<a id="sec-9-7"></a>
### 9.7 Open Questions
- Should we add the “Execution Plan” block to the core PRD template by default?
- Preferred owner defaults for features without explicit assignments?
- Exact security tooling set for scans (Semgrep ruleset, OSV, SBOM tool)?

<a id="sec-9-8"></a>
### 9.8 Ready‑to‑Implement Gate
- Condition: 9.4 all checked + QA Results Pass.
- Action: Add to roadmap with ID; flip roadmap; mirror HTML.

<a id="sec-10"></a>
## 10. Excellence Checklist (link evidence per `docs/Excellence-Standard.md`)
- [ ] Scope/intent clear; dependencies and order documented
- [ ] Minimal, reversible edits; rollback steps noted in §9.6 (if risk > low)
- [ ] Lints/build/unit/integration/E2E green (as applicable)
- [ ] QA results published and linked: `QA/2.1.1.12-orch-start-automation/test-results-<yyyy-mm-dd>.md` (Overall Status: Pass)
- [ ] Security evidence linked — no High/Critical outstanding
- [ ] Roadmap + `docs/product-roadmap.html` updated; links verified



---
name: infrastructure-baseline-prd
version: 1.0
date: 2025-08-12
status: Draft
owner: CTO
source: Plans/product-roadmap.md (M0 Founder Instance); Input/business-plan-v2.md
milestone: M0 (2.1.1.3)
---

<a id="sec-1"></a>
## 1. Executive Summary

Establish the baseline infrastructure stack: Next.js app shell, Postgres database, and Prisma ORM. Provide a reproducible local dev environment, first DB schema (tenants/users aligned with 2.1.1.1), and CI build checks. Enforce secrets hygiene and security scans. Keep changes minimal and reversible.

<a id="sec-2"></a>
## 2. Scope
- In scope:
  - Next.js project structure and build/preview wiring (coexist or host alongside current Vite app during transition).
  - Postgres dev environment (Docker or local) and Prisma setup.
  - Initial schema: `tenant`, `user` tables compatible with 2.1.1.1 seed.
  - Migration scripts and seed harness (no plaintext secrets).
  - CI build/lint/test pipeline updates as needed.
- Out of scope:
  - Feature migration to Next.js (handled by downstream items).
  - Production deployment (covered in 2.1.1.6).

<a id="sec-3"></a>
## 3. Success Criteria
- Local dev: `npm run dev` produces a running Next.js app; Prisma connects to Postgres; migrations apply cleanly.
- Schema present for `tenant` and `user`; seed harness can idempotently create Founder/Admin with env-provided secrets.
- CI: lint/build/tests green; security scans (deps/SAST/secrets/SBOM) report no High/Critical.

<a id="sec-4"></a>
## 4. User Stories
- As a developer, I can run the app locally with a working DB and apply migrations deterministically.
- As a platform owner, I have a canonical schema for tenants/users that future features can build upon.

<a id="sec-5"></a>
## 5. Functional Requirements
1. Next.js skeleton with minimal pages and health endpoint.
2. Postgres connectivity and Prisma schema with `tenant` and `user` models; migrations tracked.
3. Seed harness (script) that is safe to re-run; uses env vars for bootstrap secrets; never commits plaintext.
4. CI updates to run prisma generate/migrate in verification steps.

<a id="sec-6"></a>
## 6. Technical Requirements

<a id="sec-6-1"></a>
### 6.1 Architecture
- Keep Vite app running for current UI while introducing Next.js app directory in parallel behind a flag/preview route.
- Isolate DB access through Prisma client; no raw SQL outside migrations unless justified.

<a id="sec-6-2"></a>
### 6.2 Data Model
- `tenant { id (uuid/cuid), name (unique), createdAt }`
- `user { id (uuid/cuid), tenantId (fk), email (unique), role, passwordHash|firstLoginToken, createdAt }`

<a id="sec-6-3"></a>
### 6.3 Storage/Schema
- Prisma schema with unique constraints: `(tenant.name)`, `(user.email)`, and FK `(user.tenantId -> tenant.id)`.
- Migration strategy: `prisma migrate dev` for local; idempotent seed script.

<a id="sec-6-4"></a>
### 6.4 Validation
- Enforce non-null for required fields; validate email format at app layer.

<a id="sec-6-5"></a>
### 6.5 UI/UX
- Minimal health/status page only; no product UX changes in this scope.

<a id="sec-6-6"></a>
### 6.6 Legal/Privacy
- Secrets and PII handling: `.env` excluded from VCS; do not log credentials; document data retention defaults.

<a id="sec-7"></a>
## 7. Testing & Acceptance

<a id="sec-7-1"></a>
### 7.1 Test Scenarios
1. Local environment: start app, DB reachable, migration applies, health endpoint returns 200.
2. Seed harness: creates Founder/Admin on first run, no-ops on second run.
3. CI job: runs prisma generate and a migration check; lints/builds pass.
4. Security: dependency/SAST/secrets/SBOM scans produce no High/Critical.

<a id="sec-7-2"></a>
### 7.2 Acceptance Criteria
- All scenarios pass with evidence; Overall Status: Pass in QA results.

<a id="sec-7-3"></a>
### 7.3 QA Artifacts
- Test cases file: `QA/2.1.1.3-infrastructure-baseline/test-cases.md`
- Latest results: `QA/2.1.1.3-infrastructure-baseline/test-results-<yyyy-mm-dd>.md` (Overall Status: Pass required)

<a id="sec-8"></a>
## 8. Changelog
- v1.0: Initial draft and QA scaffold created.

<a id="sec-9"></a>
## 9. Collaboration & Review Workflow

<a id="sec-9-1"></a>
### 9.1 Roles and Order
- PM → VP-Product → Technical Product Manager → CTO → Security → QA → VP‑Eng → Implementation Owner

<a id="sec-9-2"></a>
### 9.2 Where Communication Happens
- Primary: this PRD (`PRDs/M0/2.1.1.3-infrastructure-baseline-prd.md`)
- Status: `Plans/product-roadmap.md` (2.1.1.3)

<a id="sec-9-3"></a>
### 9.3 Handoff Contracts (Inputs → Outputs)
- PM: Input strategy → Output scope, user stories, acceptance (infra slice)
- VP-Product: Input PM → Output KPIs/gates (build reproducibility, time-to-first-run)
- Technical Product Manager: Input PM/VP-Product → Output system/DB interface specs; §10 links
- CTO: Input PM/VP-Product → Output architecture/stack decisions and guardrails
- Security: Input CTO → Output threat model/controls; scans plan
- QA: Input PM/CTO → Output test scenarios; publish results
- VP‑Eng: Input all → Output feasibility/sequencing (Ready)
- Implementation Owner: Input all → Output implementation plan + rollback

<a id="sec-9-4"></a>
### 9.4 Review Log & Sign‑offs
- [ ] PM — Scope/user stories/acceptance confirmed
- [ ] VP-Product — Business alignment/KPIs confirmed
- [ ] Technical Product Manager — Specs/constraints confirmed; §10 links to specs/tests
- [ ] CTO — Architecture/stack/defaults confirmed
- [ ] Security — Threat model/controls; scans attached; no High/Critical
- [ ] QA — Test scenarios/acceptance confirmed; results published at: `QA/2.1.1.3-infrastructure-baseline/test-results-<yyyy-mm-dd>.md`
- [ ] VP‑Eng — Feasibility/sequencing confirmed (Ready)
- [ ] Implementation Owner — Implementation risks and rollback plan confirmed

<a id="sec-9-5"></a>
### 9.5 Reviewer Notes

<a id="sec-9-6"></a>
### 9.6 Decision Log

<a id="sec-9-7"></a>
### 9.7 Open Questions
- Next.js alongside Vite or immediate host migration? If parallel, define preview route and plan.
- Local Postgres via Docker vs developer-installed service? Default to Docker with fallback.
- ID type preference (UUID vs CUID) and hashing algorithm for passwords.

<a id="sec-9-8"></a>
### 9.8 Ready‑to‑Implement Gate
- Condition: All boxes checked in 9.4 AND QA results published with Overall Status: Pass and linked above.
- Action: Flip status in roadmap and start implementation; mirror HTML.

<a id="sec-10"></a>
## 10. Excellence Checklist (link evidence per `docs/Excellence-Standard.md`)
- [ ] Scope/intent clear; dependencies and order documented
- [ ] Minimal, reversible edits; rollback steps noted in 9.6 (if risk > low)
- [ ] Lints/build/unit/integration/E2E green (as applicable)
- [ ] QA results published and linked: `QA/2.1.1.3-infrastructure-baseline/test-results-<yyyy-mm-dd>.md` (Overall Status: Pass)
- [ ] Security evidence linked (secrets, deps, SAST, SBOM; DAST if applicable) — no High/Critical outstanding
- [ ] Performance/size budgets respected; evidence attached if relevant
- [ ] Roadmap + `docs/product-roadmap.html` updated in same change; links verified clickable
- [ ] Token‑efficient summary and diffs; no redundant docs or dead code


